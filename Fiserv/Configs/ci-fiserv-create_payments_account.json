{
    "validation_spec": "{}",
    "request_body_spec": "{\n    Input: {\n        Requests: [\n            {\n                __type: \"RepetitiveTransferMaintenanceRequest:http://www.opensolutions.com/CoreApi\",\n                RequestNumber: \"1\",\n                AllotmentRequests: [\n                    {\n                        ACHReceivingAccountTypeCode: ($ACHAccTypeMapping[.bank_details.account_type] // null),\n                        ACHReceivingTypeCode: \"ORG\",\n                        BalanceCategoryCode: \"NOTE\",\n                        BalanceTypeCode: \"BAL\",\n                        RtxnTypeCode: \"XWTH\",\n                        AllotmentTypeCode: (\n                            if (.product.product_code == \"SB_LOC\")\n                                then \"LPMT\"\n                            elif (.product.product_code == \"SB_TL\")\n                                then \"SCHD\"\n                            else null end \n                        // null),\n                        CalenderPeriodCode: \"MNTH\",\n                        FundTypeCode: \"EL\",\n                        DueDayNumber: 1,\n                        EffectiveDate: \"/Date(\\(now*1000 | floor))/\",\n                        NextDisbursementDate: (\n                            if (.loan_approval.approved_first_payment_date)\n                                then (.loan_approval.approved_first_payment_date \n                                    | (.+ \"T00:00:00Z\" | fromdateiso8601 * 1000) \n                                    | \"/Date(\\(.))/\"\n                                )\n                            else null\n                            end\n                        ),\n                        FixedAmount: (\n                            if (.product.product_type.product_type_code == \"LOC\")\n                                then null\n                            elif (.product.product_code == \"SB_TL\")\n                                then( .loan_interfaces[] | select(.interface_type==\"sherman\" and .is_latest==true) \n                                    | if (\n                                        .details.outLOAN_BUILDER\n                                        and .details.outLOAN_BUILDER.AmTable\n                                        and .details.outLOAN_BUILDER.AmTable.AmLine\n                                    )\n                                        then .details.outLOAN_BUILDER.AmTable.AmLine[] | select(.Idx==\"1\") | .Pmt\n                                    else null\n                                    end\n                                )\n                            else null\n                            end\n                        ),\n                        GraceDays: 0,\n                        IsACHOriginated: (.bank_details?.is_internal_account // null),\n                        ACHOriginatedOrganizationNumber: 1,\n                        ExternalAccountName: ( \n                            if .bank_details.is_internal_account == false\n                                then .loan_relations[] | select(.is_primary_borrower==true) | .full_name\n                            else null\n                            end\n                        ),\n                        ReceivingRouteNumber: (\n                            if .bank_details.is_internal_account == false\n                                then .bank_details.routing_number // null\n                            else null\n                            end\n                        ),\n                        ExternalAccountNumber: (\n                            if .bank_details.is_internal_account == false\n                                then .bank_details.account_number // null\n                            else null\n                            end\n                        ),\n                        AccountNumber: (.loan_number // null),\n                        EndDate: null,\n                        ReceivingPersonNumber: null,\n                        IsFutureReceivable: false,\n                        AllotmentDescription: (\n                            .bank_details?.account_number as $accNum\n                            | \"Commercial loan payment \\($accNum)\"\n                        ),\n                        AdditionalDescription: (\n                            .bank_details?.account_number as $accNum\n                            | \"SECU Loan Payment \\($accNum)\"\n                        ),\n                        ReceivingInternalAccountNumber: (\n                            if .bank_details.is_internal_account == true\n                                then .bank_details.account_number\n                            else null\n                            end\n                        )\n                    }\n                ]\n            }\n        ]\n    }    \n}",
    "response_body_spec": "(. as $root| ({\n    apiSuccess: (\n        $root.apiSuccess\n        and (all($root.responses.Output.Responses[]; .WasSuccessful))\n        and (all($root.responses.Output.Responses[].AllotmentResponses[]; .WasSuccessful))\n    )\n} | .apiSuccess as $success | \n    {\n        apiSuccess: $success,\n        errors: ( if ($success | not)\n            then $root.errors | {\n                errorMsg: (.errorMsg? // \"An error occurred while making request.\"),\n                errorNum: (.errorNum? // 500)\n            }\n            else null\n            end\n        ),\n        responses: ( if $success\n            then [$root.responses.Output.Responses[].AllotmentResponses[] | {\n                allotment_number: .AllotmentNumber,\n                payments_account_id: .AccountNumber\n            }]\n            else null\n            end\n        )\n    }\n))",
    "request_body_spec_config": "{\n    \"ACHAccTypeMapping\": {\n        \"checking\": \"CK\",\n        \"saving\": \"SAV\"\n    }\n}",
    "response_body_spec_config": "{}"
}