from los.configurations.models import Configuration, OrganizationConfiguration
import json

interfaces = {
    "ci-tenant-map": {
        "lrtcapital": {
            "module": "core_integration.jackhenry.jackhenry_adapter",
            "adapter": "JHAdapter",
            "corebanking_name": "jackhenry",
        },
    },
    "ci-jackhenry-common": {
        "validation_spec": "{}",
        "request_body_spec": "{}",
        "response_body_spec": {
            "errors": {"errorMsg": "", "errorNum": ""},
            "responses": "",
            "apiSuccess": True,
        },
    },
    "ci-jackhenry-entity-mapping": {
        "method_config": [],
        "relation_types": [
            "borrower",
            "co_borrower",
            "owner"
        ],
        "create_loan": {
            "method_name": {
                "loan_account_creation": "execute_create_loan_request",
                "collateral": "execute_collateral_track_add_request",
                "payment_term": "execute_payment_schedule_add_request",
                "rate_detail": "execute_rate_schedule_add_request",
                "loc_add": "execute_create_loan_loc_add"
            },
            "get_tranformed_config": {
                "loan_account_creation": "create_loan",
                "collateral": "collateral_track_add",
                "payment_term": "payment_schedule_add",
                "rate_detail": "rate_schedule_add",
                "loc_add": "create_loan_loc_add" 
            }
        },
        "customer_realtion_addition": {
            "method_name": {
                "owner": "execute_owner_customer_relation_add_request",
                "borrower": "execute_coborrower_customer_relation_add_request"
            },
            "get_tranformed_config": {
                "owner": "customer_relation_owner_add",
                "borrower": "customer_relation_coborrower_add"
            }
        },
        "create_customer": {
            "method_name": {
                "entity": "execute_create_customer_request",
                "individual": "execute_create_customer_request"
            },
            "get_tranformed_config": {
                "entity": "create_customer",
                "individual": "create_customer"
            }
        },
        "search_accounts": {},
        "search_customers": {
            "method_name": {
                "entity": "execute_search_customer_request",
                "individual": "execute_search_customer_request"
            },
            "get_tranformed_config": {
                "entity": "search_customer",
                "individual": "search_customer"
            }
        },
        "default_document_type": "",
        "stepper_list": ["loan_account_creation", "relation", "collateral", "payment_term", "rate_detail", "loc_add"]
    },
    "ci-jackhenry-search_customer": {
        "validation_spec": "{}",
        "request_body_spec": "{ TaxId: ((.loan_relations[] | .tin) // null)}",
        "response_body_spec": '{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ cif: .responses.Id }] else [] end) }',
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}",
        "xml_template": '<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><SOAP-ENV:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>{{XUserName}}</wsse:Username><wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{XPassword}}</wsse:Password><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">{{current_timestamp}}</wsu:Created></wsse:UsernameToken></wsse:Security></SOAP-ENV:Header><SOAP-ENV:Body><CustSrch xmlns="http://jackhenry.com/jxchange/TPG/2008"><SrchMsgRqHdr><jXchangeHdr><JxVer/><AuditUsrId>{{XAuditUser}}</AuditUsrId><AuditWsId>{{XAuditWorkStation}}</AuditWsId><Ver_1/><jXLogTrackingId>{{jXLogTrackingId}}</jXLogTrackingId><Ver_2/><InstRtId>{{XInstitutionRoutingID}}</InstRtId><InstEnv>{{XEnvironment}}</InstEnv><Ver_3/><BusCorrelId>{{BusCorrelId}}</BusCorrelId><Ver_4/><WorkflowCorrelId/><Ver_5/><ValidConsmName>{{XValidConsumerName}}</ValidConsmName><ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd><Ver_6/></jXchangeHdr><MaxRec>20</MaxRec><Cursor/><Ver_1/><Ver_2/><Ver_3/></SrchMsgRqHdr><TaxId>{{TaxId}}</TaxId><Ver_1/><Ver_2/><Ver_3/><Ver_4/><IncXtendElemArray><IncXtendElemInfo><XtendElem>x_PersonName</XtendElem><Ver_1/></IncXtendElemInfo></IncXtendElemArray><Ver_5/><Ver_6/><Ver_7/></CustSrch></SOAP-ENV:Body></SOAP-ENV:Envelope>',
        "xml_error_path": "s:Envelope/s:Body/CustSrchResponse/SrchMsgRsHdr/MsgRecInfoArray/MsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/CustSrchResponse/CustSrchRecArray/CustSrchRec/CustId",
        "xsd_name": "TPG_CustomerMaster",
        "timeout": 30
    },
    "ci-jackhenry-create_customer": {
        "validation_spec": "{}",
        "xsd_name": "TPG_CustomerMaster",
        "xml_template": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<SOAP-ENV:Envelope\n    xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\n    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n    <SOAP-ENV:Header>\n        <wsse:Security\n            xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\n            xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n            <wsse:UsernameToken\n                xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\n                <wsse:Username>{{XUserName}}</wsse:Username>\n                <wsse:Password\n                    Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\">\n                    {{XPassword}}</wsse:Password>\n                <wsu:Created\n                    xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n                    {{current_timestamp}}</wsu:Created>\n            </wsse:UsernameToken>\n        </wsse:Security>\n    </SOAP-ENV:Header>\n    <SOAP-ENV:Body>\n        <CustAdd xmlns=\"http://jackhenry.com/jxchange/TPG/2008\">\n            <MsgRqHdr>\n                <jXchangeHdr>\n                    <JxVer />\n                    <AuditUsrId>{{XAuditUser}}</AuditUsrId>\n                    <AuditWsId>{{XAuditWorkStation}}</AuditWsId>\n                    <AuthenUsrId />\n                    <ConsumerName />\n                    <ConsumerProd />\n                    <Ver_1 />\n                    <jXLogTrackingId>{{guid}}</jXLogTrackingId>\n                    <Ver_2 />\n                    <InstRtId>{{XInstitutionRoutingID}}</InstRtId>\n                    <InstEnv>{{XEnvironment}}</InstEnv>\n                    <Ver_3 />\n                    <BusCorrelId>{{guid}}</BusCorrelId>\n                    <Ver_4 />\n                    <WorkflowCorrelId />\n                    <Ver_5 />\n                    <ValidConsmName>{{XValidConsumerName}}</ValidConsmName>\n                    <ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd>\n                    <Ver_6 />\n                </jXchangeHdr>\n            </MsgRqHdr>\n            \n            <ErrOvrRdInfoArray>\n                {% for ErrOvrRd in conditioningData.ErrOvrRds %}\n                <ErrOvrRd>\n                    <ErrCode>{{ErrOvrRd}}</ErrCode>\n                    <Ver_1 />\n                </ErrOvrRd>\n                {% endfor %}\n            </ErrOvrRdInfoArray>\n            \n            <CustDetail>\n                <PersonName>\n                    <ComName>{{CustDetail.PersonName.ComName}}</ComName>\n\n                    {% if conditioningData.partyType == \"individual\" %}\n                    <FirstName>{{CustDetail.PersonName.FirstName}}</FirstName>\n                    <MiddleName>{{CustDetail.PersonName.MiddleName}}</MiddleName>\n                    <LastName>{{CustDetail.PersonName.LastName}}</LastName>\n                    {% endif %}\n\n                    <x_PersonName>\n                        {% if conditioningData.partyType == \"individual\" %}\n                        <NameSuffix>{{CustDetail.PersonName.x_PersonName.NameSuffix}}</NameSuffix>\n                        {% endif %}\n\n                        {% if conditioningData.partyType == \"entity\" %}\n                        <LegalName>{{CustDetail.PersonName.x_PersonName.LegalName}}</LegalName>\n                        {% endif %}\n                    </x_PersonName>\n                </PersonName>\n\n                <Addr>\n                    <StreetAddr1>{{CustDetail.Addr.StreetAddr1}}</StreetAddr1>\n                    <StreetAddr2>{{CustDetail.Addr.StreetAddr2}}</StreetAddr2>\n                    <City>{{CustDetail.Addr.City}}</City>\n                    <StateCode>{{CustDetail.Addr.StateCode}}</StateCode>\n                    <PostalCode>{{CustDetail.Addr.PostalCode}}</PostalCode>\n                    <DlvryPt>{{CustDetail.Addr.DlvryPt}}</DlvryPt>\n                </Addr>\n\n                <CustType>{{CustDetail.CustType}}</CustType>\n\n                {% if conditioningData.isSoleProp or conditioningData.partyType == \"entity\" %}\n                <NAICSCode>{{CustDetail.NAICSCode}}</NAICSCode>\n                {% endif %}\n\n                {% if conditioningData.partyType == \"individual\" %}\n                <BirthDt>{{CustDetail.BirthDt}}</BirthDt>\n                {% endif %}\n\n                {% if conditioningData.isSoleProp %}\n                <EmplName>{{CustDetail.EmplName}}</EmplName>\n                {% endif %}\n\n                <EmailArray>\n                    <EmailInfo>\n                        <EmailAddr>{{CustDetail.EmailArray.EmailInfo.EmailAddr}}</EmailAddr>\n                        <EmailType>Primary E-Mail</EmailType>\n                    </EmailInfo>\n                </EmailArray>\n\n                <PhoneArray>\n                    <PhoneInfo>\n                        <PhoneType>{{CustDetail.PhoneArray.PhoneInfo.PhoneType}}</PhoneType>\n                        <PhoneExt>{{CustDetail.PhoneArray.PhoneInfo.PhoneExt}}</PhoneExt>\n                        <PhoneNum>{{CustDetail.PhoneArray.PhoneInfo.PhoneNum}}</PhoneNum>\n                    </PhoneInfo>\n                </PhoneArray>\n\n                <CrScoreArray>\n                    <CrScoreInfo>\n                        <CrScoreId>{{CustDetail.CrScoreArray.CrScoreInfo.CrScoreId}}</CrScoreId>\n\n                        {% if conditioningData.partyType == \"individual\" %}\n                        <CertCode>{{CustDetail.CrScoreArray.CrScoreInfo.CertCode}}</CertCode>\n                        <CertCodeDt>{{CustDetail.CrScoreArray.CrScoreInfo.CertCodeDt}}</CertCodeDt>\n                        {% endif %}\n\n                    </CrScoreInfo>\n                </CrScoreArray>\n            </CustDetail>\n\n            <TaxDetail>\n                <TINInfo>\n                    <TINCode>{{TaxDetail.TINInfo.TINCode}}</TINCode>\n                    <TaxId>{{TaxDetail.TINInfo.TaxId}}</TaxId>\n\n                    {% if conditioningData.partyType == \"individual\" %}\n                    <CertCode>{{TaxDetail.TINInfo.CertCode}}</CertCode>\n                    <CertCodeDt>2025-08-06</CertCodeDt>\n                    {% endif %}\n\n                </TINInfo>\n\n                {% if conditioningData.partyType == \"individual\" %}\n                <Alien>\n                    <CitzCntryType>{{TaxDetail.Alien.CitzCntryType}}</CitzCntryType>\n                </Alien>\n                {% endif %}\n\n                <FedWithCode>{{TaxDetail.FedWithCode}}</FedWithCode>\n                <StateWithCode>{{TaxDetail.StateWithCode}}</StateWithCode>\n            </TaxDetail>\n\n            <BusDetail>\n                <BrCode>{{BusDetail.BrCode}}</BrCode>\n                <OffCode>{{BusDetail.OffCode}}</OffCode>\n                <CustCode>{{BusDetail.CustCode}}</CustCode>\n\n                <InsiderCode>{{BusDetail.InsiderCode}}</InsiderCode>\n\n                <LangType>{{BusDetail.LangType}}</LangType>\n                <NetWorth>{{BusDetail.NetWorth}}</NetWorth>\n                <NetWorthAmt>{{BusDetail.NetWorthAmt}}</NetWorthAmt>\n            </BusDetail>\n\n            <RegDetail>\n                <ReqLegalEntityType>{{RegDetail.ReqLegalEntityType}}</ReqLegalEntityType>\n\n                {% if conditioningData.partyType == \"individual\" %}\n                <BenflOwnExclCode>{{RegDetail.BenflOwnExclCode}}</BenflOwnExclCode>\n                {% endif %}\n\n                <AnnRevenueAmt>{{RegDetail.AnnRevenueAmt}}</AnnRevenueAmt>\n\n                <CRARec>\n                    <CRAStateCode>{{RegDetail.CRARec.CRAStateCode}}</CRAStateCode>\n                    <CRACountyCode>{{RegDetail.CRARec.CRACountyCode}}</CRACountyCode>\n                    <CRACenTract>{{RegDetail.CRARec.CRACenTract}}</CRACenTract>\n                    <CRASMSACode>{{RegDetail.CRARec.CRASMSACode}}</CRASMSACode>\n                    <CRALoc>{{RegDetail.CRARec.CRALoc}}</CRALoc>\n                    <CRAIncmLvl>{{RegDetail.CRARec.CRAIncmLvl}}</CRAIncmLvl>\n                </CRARec>\n            </RegDetail>\n        </CustAdd>\n    </SOAP-ENV:Body>\n\n</SOAP-ENV:Envelope>",
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/CustAddResponse/CustId",
        "request_body_spec": "    (\n        . as $root |\n        $root.loan_relations[0] |\n        { \n            CustDetail: ( \n                {\n                    PersonName: {\n                        ComName: (.full_name // null),\n                        FirstName: (.first_name // null),\n                        MiddleName: (.middle_name // null),\n                        LastName:  (.last_name // null),\n                        x_PersonName: {\n                            NameSuffix: (.suffix // null),\n                            LegalName: (.business_name // null)\n                        }\n                    },\n                    Addr: (\n                        .relation_addresses[] | \n                        select(.address_type == \"permanent\") |\n                        {\n                            StreetAddr1: (.address_line_1 // null),\n                            StreetAddr2: (.address_line_2 // null),\n                            City: (.city // null),\n                            StateCode: (.state // null),\n                            PostalCode: (.zip_code // null),\n                            DlvryPt: (.zip_code_plus4 // null),\n                        }\n                    ),\n                    CustType: (\n                        if .party_type == \"individual\"\n                            then \"Y\"\n                        elif .party_type == \"entity\"\n                            then \"N\"\n                        else null\n                        end\n                    ),\n                    NAICSCode: (.naics_code // null),\n                    BirthDt: (if .party_type == \"individual\" then .dob else null end),\n                    EmplName: ( if .party_type == \"entity\" then .business_name else null end),\n                    EmailArray: {\n                        EmailInfo: {\n                            EmailAddr: (.email // null)\n                        }\n                    },\n                    PhoneArray: {\n                        PhoneInfo: {\n                            PhoneNum: (.work_phone // null),\n                            PhoneExt: \"+1\",\n                            PhoneType: (\n                                if .party_type == \"individual\" \n                                    then \"Home Cell Phone\"\n                                elif .party_type == \"entity\" \n                                    then \"Business Phone\"\n                                else null \n                                end\n                            )\n                        }\n                    },\n                    CrScoreArray: {\n                        CrScoreInfo: {\n                            CrScoreId: ($root.fico_score // null)\n                        }\n                    }\n                }\n            ),\n            TaxDetail: (\n                {\n                    TINInfo: {\n                        TINCode: (\n                            if .tin_type == \"EIN\" \n                                then \"T\" \n                            elif .tin_type == \"SSN\" \n                                then \"I\" \n                            else null \n                            end\n                        ),\n                        TaxId: (.tin // null),\n                        CertCode: \"C\",\n                    },\n                    Alien: {\n                        CitzCntryType: \"US\"\n                    },\n                    FedWithCode: \"0\",\n                    StateWithCode: 0\n                }\n            ),\n            BusDetail: (\n                {\n                    OffCode: \"BNO\",\n                    BrCode: \"51\",\n                    CustCode: \"Q\",\n                    NetWorth: (\n                        if .details?.total_business_net_worth \n                            then .details?.total_business_net_worth\n                        else null\n                        end\n                    ),\n                    LangType: \"English\",\n                    NetWorthAmt: (\n                        if .details?.total_business_net_worth \n                            then .details?.total_business_net_worth\n                        else null\n                        end\n                    )\n                }\n            ),\n            RegDetail: (\n                {\n                    CRARec: (\n                        $root.geocoding_details[0] | \n                        {\n                            CRAStateCode: ($root.details.cra_details?.state_code // null),\n                            CRACountyCode: (.county_code // null),\n                            CRACenTract: (.tract_code // null),\n                            CRASMSACode: (.MSA_code // null),\n                            CRALoc: (.address // null),\n                            CRAIncmLvl: 1,\n                        }\n                    ),\n                    ReqLegalEntityType: (\n                        if .party_type == \"individual\"\n                            then false\n                        elif .party_type == \"entity\"\n                            then true\n                        else null\n                        end\n                    ),\n                    BenflOwnExclCode: (\n                        if .party_type == \"individual\"\n                            then \"NP\"\n                        else null\n                        end\n                    ),\n                    AnnRevenueAmt: ($root.cra_gross_annual_revenue // null)\n                }\n            ),\n            conditioningData:{\n                isSoleProp: (\n                    if (\n                        .party_type == \"individual\" \n                        and .entity_type == \"sole_proprietor\" \n                        and .relation_type == \"borrower\"\n                        and (.is_collateral_related | not) \n                    ) then true\n                    else false\n                    end\n                ),\n                ErrOvrRds: [410023, 410050, 410059, 410079, 410017],\n                entityType: (.entity_type // null),\n                partyType: (.party_type // null)\n            }\n        }\n    )",
        "response_body_spec": "{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true then { customerid: .responses.Id } else null end) }",
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}"
    },
    "ci-jackhenry-account_id_gen": {
        "validation_spec": "{}",
        "request_body_spec": '{ AcctType: "L", ProdCode: "CC", QtyNeeded: 1 }',
        "response_body_spec": '{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ cif: .responses.Id }] else [] end) }',
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}",
        "xml_template": '<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><SOAP-ENV:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>{{XUserName}}</wsse:Username><wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{XPassword}}</wsse:Password><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">{{current_timestamp}}</wsu:Created></wsse:UsernameToken></wsse:Security></SOAP-ENV:Header><SOAP-ENV:Body><AcctIdGen xmlns="http://jackhenry.com/jxchange/TPG/2008"><MsgRqHdr><jXchangeHdr><JxVer /><AuditUsrId>{{XAuditUser}}</AuditUsrId><AuditWsId>{{XAuditWorkStation}}</AuditWsId><AuthenUsrId /><ConsumerName /><ConsumerProd /><Ver_1 /><jXLogTrackingId>{{jXLogTrackingId}}</jXLogTrackingId><Ver_2 /><InstRtId>{{XInstitutionRoutingID}}</InstRtId><InstEnv>{{XEnvironment}}</InstEnv><Ver_3 /><BusCorrelId>{{guid}}</BusCorrelId><Ver_4 /><WorkflowCorrelId /><Ver_5 /><ValidConsmName>{{XValidConsumerName}}</ValidConsmName><ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd><Ver_6 /></jXchangeHdr><Ver_1 /><Ver_2 /><Ver_3 /></MsgRqHdr><ErrOvrRdInfoArray><ErrOvrRd><ErrCode /><Ver_1 /></ErrOvrRd><ErrOvrRd><ErrCode /><Ver_1 /></ErrOvrRd></ErrOvrRdInfoArray><AcctType>{{AcctType}}</AcctType><ProdCode>{{ProdCode}}</ProdCode><QtyNeeded>{{QtyNeeded}}</QtyNeeded><Custom /><Ver_1 /></AcctIdGen></SOAP-ENV:Body></SOAP-ENV:Envelope>',
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/AcctIdGenResponse/GenAcctIdArray/GenAcctId/AcctId",
        "xsd_name": "TPG_CustomerMaster",
    },
    "ci-jackhenry-create_loan": {
        "validation_spec": "{}",
        "request_body_spec": "{\n    AccountId: {\n        AcctId: (.loan_number // \"\"),\n        AcctType: \"L\"\n    },\n    LnAdd: {\n        LnInfoRec: {\n            Term: {\n                TermCnt: (.loan_approval.approved_term // null),\n                TermUnits: \"Months\"\n            },\n            PmtTerm: \"001\",\n            PmtDayOfMonth:( if (\n                (.loan_approval.approved_first_payment_date | split(\"-\")[2] == \"29\")\n                or (.loan_approval.approved_first_payment_date | split(\"-\")[2] == \"30\")\n                or (.loan_approval.approved_first_payment_date | split(\"-\")[2] == \"31\")\n                ) then \n                    (.loan_approval.approved_first_payment_date) \n                else null \n                end\n            ),\n            PmtCode: (\n                ((.pricing_details[] \n                | select(.term_position == \"term_1\")\n                | $repaymentTypeMapping[.repayment_type]) // null)\n            ),\n            PmtAmt: (\n                (.loan_interfaces[] \n                | select(.is_latest==true and .interface_type==\"sherman\") \n                |(\n                    (.details.outLOAN_BUILDER.AmTable.AmLine[] \n                    | select(.Idx==\"1\")) | .Pmt | tonumber // null)\n                )\n            ),\n            PIAmt: (\n                (.loan_interfaces[] \n                | select(.is_latest==true and .interface_type==\"sherman\") \n                |(\n                    (.details.outLOAN_BUILDER.AmTable.AmLine[] \n                    | select(.Idx==\"1\")) | .Pmt | tonumber // null)\n                )\n            ),\n            OrigBal: (.approved_amount // \"\"),\n            OpenDt: (now | strftime(\"%Y-%m-%d\")),\n            OffCode: (.boarding_details.branch_code // null),\n            NxtSchedPmtDt: (.loan_approval.approved_first_payment_date // \"\"),\n            MatDt: (.maturity_date // \"\"),\n            IntRate: (.loan_approval.approved_rate/100 // \"\"),\n            IntBasis: ($accuralMapping[.accrual_method | tostring] // null),\n            BrCode: \"51\",\n            ProdCode: \"26\",\n            AcctStat: \"4\",\n            CustId: (.loan_relations[] | select(.is_primary_borrower == true) | .external_customer_id // \"\"),\n            OddDaysIntBasis: \"B\"\n        },\n        LnAcctInfo: {\n            VehicleId: (\n                if any(.collaterals[]; .category==\"vehicles\")\n                    then \"VIN\"\n                else null\n                end\n            ),\n            SubPrimeLnCode: \"N\",\n            State: (.loan_relations[] | select(.is_primary_borrower == true) | .state_of_establishment // \"\"),\n            PurpCode: \"98\",\n            PrtPastDueNotCode: \"Y\",\n            OrigLnToValRatio: (.approved_amount // null),\n            LateChgCode: \"CL1\",\n            DeptCode: \"C\",\n            CurLnToValRatio: (.approved_amount // null),\n            CrRatingCode: \"5\",\n            CollatCode: \"14\",\n            AnnIncmAmt: (.cra_gross_annual_revenue // null),\n            AcctClsfCode: \"Q\",\n            CombLTV: (.approved_amount // null),\n            CrScoreId: (.fico_score // null),\n            MoIncmAmt: (.cra_gross_annual_revenue/12 // null),\n            NumBorw: ( ([.loan_relations[] | select(.relation_type == \"borrower\")] | length) // null),\n            TotDebtPct: null,\n            LangType: \"English\",\n            CrRatingCode: \"5\",\n            BorwInfoArray: {\n                BorwInfo: {\n                    BorwFICOId: (.fico_score // null)\n                }\n            },\n            CrBureauRptCode: \"N\"\n        },\n        LnBalDtInfo: {\n            FirstPmtDt: (.loan_approval.approved_first_payment_date // \"\"),\n        },\n        LnPmtInfo: {\n            UsePmtSusp: \"N\",\n            BilLeadDays: \"15\"\n        },\n        LnRateInfo: {\n            RateVarCode: ( \n                .pricing_details[] | \n                select(.term_position == \"term_1\") | \n                if .margin > 0\n                    then \"Positive\"\n                elif .margin < 0\n                    then \"Negative\"\n                else null\n                end\n            ),\n            RateRevTermUnits: \"day\",\n            RateRevTerm: 1,\n            OrigIdxVal: ((.pricing_details[] | select(.term_position == \"term_1\") | .prime_rate) // null),\n            RateVar: ((.pricing_details[] | select(.term_position == \"term_1\") | .differential_rate) // null),\n            RateFlr: (.min_rate // null),\n            RateCeil: (.max_rate // null),\n        },\n        LnRealEstateInfo: (\n            .collaterals[0] | \n            {    \n                PropStreet: (\n                    .collateral_addresses[0] |\n                    select(.address_type == \"permanent\") |\n                    \"\\(.address_line_1) \\(.address_line_2)\"\n                ),\n                FloodInsurCode: (\n                    if .collaterals[0].is_flood_search_required == true\n                        then \"Y\"\n                    elif .collaterals[0].is_flood_search_required == false\n                        then \"N\"\n                    else null\n                    end\n                ),\n                ApprDt: ( .collaterals[0] | .collateral_appraisal.details?.report_due_date // null ),\n                OccupCode: null,\n                PropCounty: ( .collaterals[0] | .collateral_addresses[0] | .county // null ),\n                PropState: ( .collaterals[0] | .collateral_addresses[0] | .state // null ),\n                PropPostalCode: ( .collaterals[0] | .collateral_addresses[0] | .zip_code // null ),\n                PropCity: ( .collaterals[0] | .collateral_addresses[0] | .city // null ),\n                ApprVal: ( .collaterals[0] | .collateral_appraisal.details.report_price // null )\n            }\n        ),\n        LnRegRptInfo: {\n            NAICSCode: (.account_naics_code // null),\n            CRARec: (\n                .details.cra_details | \n                {\n                    CRAStateCode: (.cra_state_code // null),\n                    CRACountyCode: (.cra_country_code // null),\n                    CRACenTract: (.tract_code // null),\n                    CRASMSACode: (.MSA_code // null),\n                    CRALoc: (.address // null),\n                }\n            ),\n            CallRptCode: \"4A\",\n            Req1098: \"N\",\n            SBAGuarPct: (.sba_express_details.sba_guaranty_percent // null),\n            SBAGuarId: (.sba_number // null),\n            SBABasisPts: (if (.approved_amount <= 150000) then 1.50 else 3.00 end // null)\n        }\n    }\n}",
        "response_body_spec": "{ \n apiSuccess: .apiSuccess,\n errors: { \n errorNum: (if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorNum else null end),\n errorMsg: ((if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) \n },\n responses: (if .apiSuccess == true and .responses.Id then [\n { \n status: .responses.Id \n }\n ] else [] end)\n}",
        "request_body_spec_config": "{\n \"repaymentTypeMapping\": {\n \"principal_and_interest\": 0,\n \"interest_only\": 2\n },\n \"accuralMapping\": {\n \"310\": 1,\n \"320\": 0,\n \"201\": 3\n }\n}",
        "xml_template": "<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\n    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n    <SOAP-ENV:Header>\n        <wsse:Security\n            xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\n            xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n            <wsse:UsernameToken\n                xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\n                <wsse:Username>{{XUserName}}</wsse:Username>\n                <wsse:Password\n                    Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\">\n                    {{XPassword}}</wsse:Password>\n                <wsu:Created\n                    xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n                    {{current_timestamp}}</wsu:Created>\n            </wsse:UsernameToken>\n        </wsse:Security>\n    </SOAP-ENV:Header>\n    <SOAP-ENV:Body>\n        <AcctAdd xmlns=\"http://jackhenry.com/jxchange/TPG/2008\">\n            <MsgRqHdr>\n                <jXchangeHdr>\n                    <JxVer />\n                    <AuditUsrId>{{XAuditUser}}</AuditUsrId>\n                    <AuditWsId>{{XAuditWorkStation}}</AuditWsId>\n                    <AuthenUsrId />\n                    <ConsumerName />\n                    <ConsumerProd />\n                    <Ver_1 />\n                    <jXLogTrackingId>{{$guid}}</jXLogTrackingId>\n                    <Ver_2 />\n                    <InstRtId>{{XInstitutionRoutingID}}</InstRtId>\n                    <InstEnv>{{XEnvironment}}</InstEnv>\n                    <Ver_3 />\n                    <BusCorrelId>{{$guid}}</BusCorrelId>\n                    <Ver_4 />\n                    <WorkflowCorrelId />\n                    <Ver_5 />\n                    <ValidConsmName>{{XValidConsumerName}}</ValidConsmName>\n                    <ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd>\n                    <Ver_6 />\n                </jXchangeHdr>\n                <Ver_1 />\n                <Ver_2 />\n                <Ver_3 />\n            </MsgRqHdr>\n\n            <ErrOvrRdInfoArray>\n                <ErrOvrRd>\n                    <ErrCode />\n                    <Ver_1 />\n                    <BusSvcType />\n                    <Ver_2 />\n                </ErrOvrRd>\n                <ErrOvrRd>\n                    <ErrCode />\n                    <Ver_1 />\n                    <BusSvcType />\n                    <Ver_2 />\n                </ErrOvrRd>\n            </ErrOvrRdInfoArray>\n\n            <AccountId>\n                <AcctId>{{AccountId.AcctId}}</AcctId>\n                <AcctType>{{AccountId.AcctType}}</AcctType>\n            </AccountId>\n\n            <LnAdd>\n                <LnInfoRec>\n                    <Term>\n                        <TermCnt>{{LnAdd.LnInfoRec.Term.TermCnt}}</TermCnt>\n                        <TermUnits>{{LnAdd.LnInfoRec.Term.TermUnits}}</TermUnits>\n                    </Term>\n                    <RemPmtCnt>{{LnAdd.LnInfoRec.RemPmtCnt}}</RemPmtCnt>\n                    <PmtTermUnits>{{LnAdd.LnInfoRec.PmtTermUnits}}</PmtTermUnits>\n                    <PmtTerm>{{LnAdd.LnInfoRec.PmtTerm}}</PmtTerm>\n                    <PmtCode>{{LnAdd.LnInfoRec.PmtCode}}</PmtCode>\n                    <PmtAmt>{{LnAdd.LnInfoRec.PmtAmt}}</PmtAmt>\n                    <PIAmt>{{LnAdd.LnInfoRec.PIAmt}}</PIAmt>\n                    <OrigBal>{{LnAdd.LnInfoRec.OrigBal}}</OrigBal>\n                    <OpenDt>{{LnAdd.LnInfoRec.OpenDt}}</OpenDt>\n                    <OffCode>{{LnAdd.LnInfoRec.OffCode}}</OffCode>\n                    <MatDt>{{LnAdd.LnInfoRec.MatDt}}</MatDt>\n                    <IntRate>{{LnAdd.LnInfoRec.IntRate}}</IntRate>\n                    <BrCode>{{LnAdd.LnInfoRec.BrCode}}</BrCode>\n                    <ProdCode>{{LnAdd.LnInfoRec.ProdCode}}</ProdCode>\n                    <AcctStat>{{LnAdd.LnInfoRec.AcctStat}}</AcctStat>\n                    <CustId>{{LnAdd.LnInfoRec.CustId}}</CustId>\n                    <OddDaysIntBasis>{{LnAdd.LnInfoRec.OddDaysIntBasis}}</OddDaysIntBasis>\n                </LnInfoRec>\n\n                <LnAcctInfo>\n                    <SubPrimeLnCode>{{LnAdd.LnAcctInfo.SubPrimeLnCode}}</SubPrimeLnCode>\n                    <State>{{LnAdd.LnAcctInfo.State}}</State>\n                    <PurpCode>{{LnAdd.LnAcctInfo.PurpCode}}</PurpCode>\n                    <PrtPastDueNotCode>{{LnAdd.LnAcctInfo.PrtPastDueNotCode}}</PrtPastDueNotCode>\n                    <OrigLnToValRatio>{{LnAdd.LnAcctInfo.OrigLnToValRatio}}</OrigLnToValRatio>\n                    <LateChgCode>{{LnAdd.LnAcctInfo.LateChgCode}}</LateChgCode>\n                    <DeptCode>{{LnAdd.LnAcctInfo.DeptCode}}</DeptCode>\n                    <CurLnToValRatio>{{LnAdd.LnAcctInfo.CurLnToValRatio}}</CurLnToValRatio>\n                    <CrRatingCode>{{LnAdd.LnAcctInfo.CrRatingCode}}</CrRatingCode>\n                    <CollatCode>{{LnAdd.LnAcctInfo.CollatCode}}</CollatCode>\n                    <AnnIncmAmt>{{LnAdd.LnAcctInfo.AnnIncmAmt}}</AnnIncmAmt>\n                    <AcctClsfCode>{{LnAdd.LnAcctInfo.AcctClsfCode}}</AcctClsfCode>\n                    <CombLTV>{{LnAdd.LnAcctInfo.CombLTV}}</CombLTV>\n                    <CrScoreId>{{LnAdd.LnAcctInfo.CrScoreId}}</CrScoreId>\n                    <MoIncmAmt>{{LnAdd.LnAcctInfo.MoIncmAmt}}</MoIncmAmt>\n                    <NumBorw>{{LnAdd.LnAcctInfo.NumBorw}}</NumBorw>\n                    <TotDebtPct>{{LnAdd.LnAcctInfo.TotDebtPct}}</TotDebtPct>\n                    <CrBureauRptCode>{{LnAdd.LnAcctInfo.CrBureauRptCode}}</CrBureauRptCode>\n                    <PrtCouponBook>{{LnAdd.LnAcctInfo.PrtCouponBook}}</PrtCouponBook>\n                </LnAcctInfo>\n\n                <LnBalDtInfo>\n                    <FirstPmtDt>{{LnAdd.LnBalDtInfo.FirstPmtDt}}</FirstPmtDt>\n                </LnBalDtInfo>\n\n                <LnPmtInfo>\n                    <UsePmtSusp>{{LnAdd.LnPmtInfo.UsePmtSusp}}</UsePmtSusp>\n                    <BilLeadDays>{{LnAdd.LnPmtInfo.BilLeadDays}}</BilLeadDays>\n                </LnPmtInfo>\n\n                <LnRateInfo>\n                    <RateVarCode>{{LnAdd.LnRateInfo.RateVarCode}}</RateVarCode>\n                    <RateVar>{{LnAdd.LnRateInfo.RateVar}}</RateVar>\n                    <RateFlr>{{LnAdd.LnRateInfo.RateFlr}}</RateFlr>\n                    <RateCeil>{{LnAdd.LnRateInfo.RateCeil}}</RateCeil>\n                    <OrigIdxVal>{{LnAdd.LnRateInfo.OrigIdxVal}}</OrigIdxVal>\n                </LnRateInfo>\n\n                <LnRealEstateInfo>\n                    <PropStreet>{{LnAdd.LnRealEstateInfo.PropStreet}}</PropStreet>\n                    <PropState>{{LnAdd.LnRealEstateInfo.PropState}}</PropState>\n                    <PropPostalCode>{{LnAdd.LnRealEstateInfo.PropPostalCode}}</PropPostalCode>\n                    <PropCity>{{LnAdd.LnRealEstateInfo.PropCity}}</PropCity>\n                    <FloodInsurCode>{{LnAdd.LnRealEstateInfo.FloodInsurCode}}</FloodInsurCode>\n                    <ApprVal>{{LnAdd.LnRealEstateInfo.ApprVal}}</ApprVal>\n                    <ApprDt>{{LnAdd.LnRealEstateInfo.ApprDt}}</ApprDt>\n                    <OccupCode>{{LnAdd.LnRealEstateInfo.OccupCode}}</OccupCode>\n                    <PropCounty>{{LnAdd.LnRealEstateInfo.PropCounty}}</PropCounty>\n                </LnRealEstateInfo>\n\n                <LnRegRptInfo>\n                    <NAICSCode>{{LnAdd.LnRegRptInfo.NAICSCode}}</NAICSCode>\n                    <CallRptCode>{{LnAdd.LnRegRptInfo.CallRptCode}}</CallRptCode>\n                    <Req1098>{{LnAdd.LnRegRptInfo.Req1098}}</Req1098>\n                    <SBAGuarPct>{{LnAdd.LnRegRptInfo.SBAGuarPct}}</SBAGuarPct>\n                    <SBAGuarId>{{LnAdd.LnRegRptInfo.SBAGuarId}}</SBAGuarId>\n                    <SBABasisPts>{{LnAdd.LnRegRptInfo.SBABasisPts}}</SBABasisPts>\n                    <GLCostCtr>{{LnAdd.LnRegRptInfo.GLCostCtr}}</GLCostCtr>\n                </LnRegRptInfo>\n            </LnAdd>\n        </AcctAdd>\n    </SOAP-ENV:Body>\n</SOAP-ENV:Envelope>",
        "response_body_spec_config": "{}",
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/LnAppRgtrAddResponse/LnAppId",
        "xsd_name": "TPG_DepositMaster"
    },
    "ci-jackhenry-customer_relation_owner_add": {
        "xsd_name": "TPG_CustomerMaster",
        "xml_template": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<SOAP-ENV:Envelope\n    xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\n    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n    <SOAP-ENV:Header>\n        <wsse:Security\n            xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\n            xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n            <wsse:UsernameToken\n                xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\n                <wsse:Username>{{XUserName}}</wsse:Username>\n                <wsse:Password\n                    Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\">\n                    {{XPassword}}</wsse:Password>\n                <wsu:Created\n                    xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n                    {{current_timestamp}}</wsu:Created>\n            </wsse:UsernameToken>\n        </wsse:Security>\n    </SOAP-ENV:Header>\n    <SOAP-ENV:Body>\n        <CustRelAdd\n            xmlns=\"http://jackhenry.com/jxchange/TPG/2008\">\n            <MsgRqHdr>\n                <jXchangeHdr>\n                    <JxVer />\n                    <AuditUsrId>{{XAuditUser}}</AuditUsrId>\n                    <AuditWsId>{{XAuditWorkStation}}</AuditWsId>\n                    <AuthenUsrId />\n                    <ConsumerName />\n                    <ConsumerProd />\n                    <Ver_1 />\n                    <jXLogTrackingId>{{$guid}}</jXLogTrackingId>\n                    <Ver_2 />\n                    <InstRtId>{{XInstitutionRoutingID}}</InstRtId>\n                    <InstEnv>{{XEnvironment}}</InstEnv>\n                    <Ver_3 />\n                    <BusCorrelId>{{$guid}}</BusCorrelId>\n                    <Ver_4 />\n                    <WorkflowCorrelId />\n                    <Ver_5 />\n                    <ValidConsmName>{{XValidConsumerName}}</ValidConsmName>\n                    <ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd>\n                    <Ver_6 />\n                </jXchangeHdr>\n                <Ver_1 />\n                <Ver_2 />\n                <Ver_3 />\n            </MsgRqHdr>\n            <CustId>{{CustRelAdd.CustId}}</CustId>\n            <CustRelRec>\n                <Ver_1 />\n                <Ver_2 />\n                <Ver_3 />\n                <IdVerifyBy>{{CustRelAdd.CustRelRec.IdVerifyBy}}</IdVerifyBy>\n                <IdVerifyRsnCode>{{CustRelAdd.CustRelRec.IdVerifyRsnCode}}</IdVerifyRsnCode>\n                <VerifyDt>{{CustRelAdd.CustRelRec.VerifyDt}}</VerifyDt>\n                <Ver_4 />\n            </CustRelRec>\n            <Ver_1 />\n            <BenflOwnInfo>\n                <CustId>{{CustRelAdd.BenflOwnInfo.CustId}}</CustId>\n                <PersonName>\n                    <ComName>{{CustRelAdd.BenflOwnInfo.PersonName.ComName}}</ComName>\n                    <Ver_1 />\n                </PersonName>\n                <BenflOwnType>{{CustRelAdd.BenflOwnInfo.BenflOwnType}}</BenflOwnType>\n                <CntlIndivTitle>{{CustRelAdd.BenflOwnInfo.CntlIndivTitle}}</CntlIndivTitle>\n                <BenflOwnPct>{{CustRelAdd.BenflOwnInfo.BenflOwnPct}}</BenflOwnPct>\n                <Ver_1 />\n            </BenflOwnInfo>\n            <Ver_2 />\n            <Ver_3 />\n        </CustRelAdd>\n    </SOAP-ENV:Body>\n</SOAP-ENV:Envelope>",
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "validation_spec": "{}",
        "xml_success_path": "s:Envelope/s:Body/CustRelAddResponse/RsStat",
        "request_body_spec": "(\n    . as $root |\n    { \n        CustId: ( \n            $root.flat_relations | \n            map(select(.id == $root.id))[0].parent_id as $pid | \n            map(select(.id == $pid))[0].external_customer_id // \"\"\n        ),\n        CustRelRec: { \n            IdVerifyBy: ($root.loan_officer_name // null),\n            IdVerifyRsnCode: \"NEW\",\n            VerifyDt: \"2024-02-28\" \n        },\n        BenflOwnInfo:( \n            $root.loan_relations[0] | \n            { \n                CustId: .external_customer_id,\n                PersonName: { \n                    ComName: (.full_name // null)\n                },\n                BenflOwnType: (\n                    if .is_ben_owner_by_control \n                        then (\n                            if .ownership_percentage \n                                then \"CntlOwn\" \n                            else \"Cntl\" \n                            end\n                        ) \n                    else \"Own\"\n                    end\n                ),\n                CntlIndivTitle: ( .title // null),\n                BenflOwnPct: ( .ownership_percentage // 0),\n            }\n        )\n    }\n)",
        "response_body_spec": "{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ status: .responses.Id }] else [] end) }",
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}"
    },
    "ci-jackhenry-customer_relation_coborrower_add": {
        "xsd_name": "TPG_CustomerMaster",
        "xml_template": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<SOAP-ENV:Envelope\n    xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\n    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n    <SOAP-ENV:Header>\n        <wsse:Security\n            xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\n            xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n            <wsse:UsernameToken\n                xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\n                <wsse:Username>{{XUserName}}</wsse:Username>\n                <wsse:Password\n                    Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\">\n                    {{XPassword}}</wsse:Password>\n                <wsu:Created\n                    xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">\n                    2023-12-04T21:00:58Z</wsu:Created>\n            </wsse:UsernameToken>\n        </wsse:Security>\n    </SOAP-ENV:Header>\n    <SOAP-ENV:Body>\n        <CustRelAdd xmlns=\"http://jackhenry.com/jxchange/TPG/2008\">\n            <MsgRqHdr>\n                <jXchangeHdr>\n                    <JxVer />\n                    <AuditUsrId>{{XAuditUser}}</AuditUsrId>\n                    <AuditWsId>{{XAuditWorkStation}}</AuditWsId>\n                    <AuthenUsrId />\n                    <ConsumerName />\n                    <ConsumerProd />\n                    <Ver_1 />\n                    <jXLogTrackingId>{{$guid}}</jXLogTrackingId>\n                    <Ver_2 />\n                    <InstRtId>{{XInstitutionRoutingID}}</InstRtId>\n                    <InstEnv>{{XEnvironment}}</InstEnv>\n                    <Ver_3 />\n                    <BusCorrelId>{{$guid}}</BusCorrelId>\n                    <Ver_4 />\n                    <WorkflowCorrelId />\n                    <Ver_5 />\n                    <ValidConsmName>{{XValidConsumerName}}</ValidConsmName>\n                    <ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd>\n                    <Ver_6 />\n                </jXchangeHdr>\n                <Ver_1 />\n                <Ver_2 />\n                <Ver_3 />\n            </MsgRqHdr>\n\n            <CustId>{{CustRelAdd.CustId}}</CustId>\n            <RelAcctId>{{CustRelAdd.RelAcctId}}</RelAcctId>\n            <RelAcctType>{{CustRelAdd.RelAcctType}}</RelAcctType>\n\n            <CustRelRec>\n                <AcctRelCode>{{CustRelAdd.CustRelRec.AcctRelCode}}</AcctRelCode>\n                <CopyRelCustMail>{{CustRelAdd.CustRelRec.CopyRelCustMail}}</CopyRelCustMail>\n            </CustRelRec>\n\n        </CustRelAdd>\n    </SOAP-ENV:Body>\n</SOAP-ENV:Envelope>",
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "validation_spec": "{}",
        "xml_success_path": "s:Envelope/s:Body/CustRelAddResponse/RsStat",
        "request_body_spec": "{ \n    CustId: .loan_relations[0].external_customer_id,\n    RelAcctId: .loan_number,\n    RelAcctType: \"L\",\n    CustRelRec: { \n        AcctRelCode: (\n            .loan_relations[0] |\n            if (.relation_type == \"guarantor\")\n                then \"G\"\n            elif (.relation_type == \"co_borrower\")\n                then \"C\"\n            else null\n            end \n        ), \n        CopyRelCustMail: \"N\" \n    } \n}",
        "response_body_spec": "{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != \"\" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ status: .responses.Id }] else [] end) }",
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}"
    },
    "ci-jackhenry-collateral_track_add": {
        "validation_spec": "{}",
        "request_body_spec": '{ AccountId: { AcctId: (.loan_number // ""), AcctType: "L", }, CollatItemRec: { BrCode: "2", CollatCode: "213", CollatValAmt: (.total_collateral_value_v2 // ""), CollatItemDocDt: "2024-12-03", CollatItemDescArray: { CollatItemDescInfo: [ { CollatItemDesc: "VIN: VO157852FHI451", CollatItemDescText: "Item Description 1", }, { CollatItemDesc: "Date Purchased: December 2024", CollatItemDescText: "Item Description 2", }, { CollatItemDesc: "Year: 2024", CollatItemDescText: "Item Description 3", }, { CollatItemDesc: "Make: Volvo", CollatItemDescText: "Item Description 4", }, { CollatItemDesc: "Model: XC60", CollatItemDescText: "Item Description 5", } ] }, CollatMatDt: "2029-12-03", CollatOrigValAmt: "44000", PriceDt: "2024-12-03", CollatToLnRelCode: "Y", CollatRecDt: "2024-12-03", CollatRecCode: "MO", CollatStat: "IC", CollatStatDt: "2024-12-03", CollatSrcValCode: "A", CollatValDt: "2024-12-03", CollatOffCode: "AA0203", } }',
        "response_body_spec": '{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ status: .responses.Id }] else [] end) }',
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}",
        "xml_template": '<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><SOAP-ENV:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>{{XUserName}}</wsse:Username><wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{XPassword}}</wsse:Password><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">{{current_timestamp}}</wsu:Created></wsse:UsernameToken></wsse:Security></SOAP-ENV:Header><SOAP-ENV:Body><CollatTrackAdd xmlns="http://jackhenry.com/jxchange/TPG/2008"><MsgRqHdr><jXchangeHdr><AuditUsrId>{{XAuditUser}}</AuditUsrId><AuditWsId>{{XAuditWorkStation}}</AuditWsId><Ver_1/><jXLogTrackingId>{{jXLogTrackingId}}</jXLogTrackingId><Ver_2/><InstRtId>{{XInstitutionRoutingID}}</InstRtId><InstEnv>{{XEnvironment}}</InstEnv><Ver_3/><BusCorrelId>{{guid}}</BusCorrelId><Ver_4/><WorkflowCorrelId/><Ver_5/><ValidConsmName>{{XValidConsumerName}}</ValidConsmName><ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd><Ver_6/></jXchangeHdr><Ver_1/><Ver_2/><Ver_3/></MsgRqHdr><ErrOvrRdInfoArray/><AccountId><AcctId>{{AccountId.AcctId}}</AcctId><AcctType>{{AccountId.AcctType}}</AcctType><Ver_1/></AccountId><CollatItemRec><BrCode>{{CollatItemRec.BrCode}}</BrCode><CollatCode>{{CollatItemRec.CollatCode}}</CollatCode><CollatValAmt>{{CollatItemRec.CollatValAmt}}</CollatValAmt><CollatItemDocDt>{{CollatItemRec.CollatItemDocDt}}</CollatItemDocDt><CollatItemDescArray>{% for CollatItem in CollatItemRec.CollatItemDescArray.CollatItemDescInfo %}<CollatItemDescInfo><CollatItemDesc>{{CollatItem.CollatItemDesc}}</CollatItemDesc><CollatItemDescText>{{CollatItem.CollatItemDescText}}</CollatItemDescText><Ver_1/><Ver_2/></CollatItemDescInfo>{% endfor %}</CollatItemDescArray><CollatMatDt>{{CollatItemRec.CollatMatDt}}</CollatMatDt><CollatOrigValAmt>{{CollatItemRec.CollatOrigValAmt}}</CollatOrigValAmt><PriceDt>{{CollatItemRec.PriceDt}}</PriceDt><CollatToLnRelCode>{{CollatItemRec.CollatToLnRelCode}}</CollatToLnRelCode><CollatRecDt>{{CollatItemRec.CollatRecDt}}</CollatRecDt><CollatRecCode>{{CollatItemRec.CollatRecCode}}</CollatRecCode><CollatStat>{{CollatItemRec.CollatStat}}</CollatStat><CollatStatDt>{{CollatItemRec.CollatStatDt}}</CollatStatDt><CollatSrcValCode>{{CollatItemRec.CollatSrcValCode}}</CollatSrcValCode><CollatValDt>{{CollatItemRec.CollatValDt}}</CollatValDt><CollatOffCode>{{CollatItemRec.CollatOffCode}}</CollatOffCode><Ver_1/><Ver_2/><Ver_3/></CollatItemRec><Ver_1/></CollatTrackAdd></SOAP-ENV:Body></SOAP-ENV:Envelope>',
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/CollatTrackAddResponse/RsStat",
        "xsd_name": "TPG_LoanMaster",
    },
    "ci-jackhenry-payment_schedule_add": {
        "validation_spec": "{}",
        "request_body_spec": '{ AccountId: { AcctId: (.loan_number // ""), AcctType: "L" }, LnPmtSchedArray: [ { PmtTerm: "1", PmtTermUnits: "Months", PmtSchedNum: "12", PmtCode: "0", PmtStartDt: (.loan_approval.approved_first_payment_date // ""), PmtEndDt: (.maturity_date // ""), }, { PmtTerm: "1", PmtTermUnits: "Months", PmtSchedNum: "12", PmtCode: "0", PmtStartDt: (.loan_approval.approved_first_payment_date // ""), PmtEndDt: (.maturity_date // ""), } ] }',
        "response_body_spec": '{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ status: .responses.Id }] else [] end) }',
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}",
        "xml_template": '<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><SOAP-ENV:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>{{XUserName}}</wsse:Username><wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{XPassword}}</wsse:Password><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">{{current_timestamp}}</wsu:Created></wsse:UsernameToken></wsse:Security></SOAP-ENV:Header><SOAP-ENV:Body><LnPmtSchedAdd xmlns="http://jackhenry.com/jxchange/TPG/2008"><MsgRqHdr><jXchangeHdr><JxVer/><AuditUsrId>{{XAuditUser}}</AuditUsrId><AuditWsId>{{XAuditWorkStation}}</AuditWsId><AuthenUsrId/><ConsumerName/><ConsumerProd/><Ver_1/><jXLogTrackingId>{{jXLogTrackingId}}</jXLogTrackingId><Ver_2/><InstRtId>{{XInstitutionRoutingID}}</InstRtId><InstEnv>{{XEnvironment}}</InstEnv><Ver_3/><BusCorrelId>{{guid}}</BusCorrelId><Ver_4/><WorkflowCorrelId/><Ver_5/><ValidConsmName>{{XValidConsumerName}}</ValidConsmName><ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd><Ver_6/></jXchangeHdr><Ver_1/><Ver_2/><Ver_3/></MsgRqHdr><AccountId><AcctId>{{AccountId.AcctId}}</AcctId><AcctType>{{AccountId.AcctType}}</AcctType><Ver_1/></AccountId><LnPmtSchedArray>{% for PmtSched in LnPmtSchedArray %}<LnPmtSchedInfo><PmtTerm>{{PmtSched.PmtTerm}}</PmtTerm><PmtTermUnits>{{PmtSched.PmtTermUnits}}</PmtTermUnits><PmtSchedNum>{{PmtSched.PmtSchedNum}}</PmtSchedNum><PmtCode>{{PmtSched.PmtCode}}</PmtCode><PmtStartDt>{{PmtSched.PmtStartDt}}</PmtStartDt><PmtEndDt>{{PmtSched.PmtEndDt}}</PmtEndDt><Ver_1/><Ver_2/><Ver_3/></LnPmtSchedInfo>{% endfor %}</LnPmtSchedArray><Custom/><Ver_1/></LnPmtSchedAdd></SOAP-ENV:Body></SOAP-ENV:Envelope>',
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/LnPmtSchedAddResponse/RsStat",
        "xsd_name": "TPG_LoanMaster",
    },
    "ci-jackhenry-rate_schedule_add": {
        "validation_spec": "{}",
        "request_body_spec": '{ InAcctId: { AcctId: (.loan_number // ""), AcctType: "L" }, LnRateSchedInfo: { RateRevDt: "2025-10-30", RateRevDayOfMonth: "30", PrimeRateIdx: "100", RateVar: (if .differential_rate == null then 0 else .differential_rate/100 end), RateVarCode: "Positive", ReAmrtzPmt: "false", RateRevTerm: "6", RateRevTermUnits: "Month" } }',
        "response_body_spec": '{ apiSuccess: .apiSuccess, errors: { errorNum: (if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorNum else null end), errorMsg: ((if (.errors.errorNum != "" and .errors.errorNum != null) then .errors.errorMsg.Error else null end)) }, responses: (if .apiSuccess == true and .responses.Id then [{ status: .responses.Id }] else [] end) }',
        "request_body_spec_config": "{}",
        "response_body_spec_config": "{}",
        "xml_template": '<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><SOAP-ENV:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>{{XUserName}}</wsse:Username><wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{XPassword}}</wsse:Password><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">{{current_timestamp}}</wsu:Created></wsse:UsernameToken></wsse:Security></SOAP-ENV:Header><SOAP-ENV:Body><LnRateSchedAdd xmlns="http://jackhenry.com/jxchange/TPG/2008"><MsgRqHdr><jXchangeHdr><JxVer/><AuditUsrId>{{XAuditUser}}</AuditUsrId><AuditWsId>{{XAuditWorkStation}}</AuditWsId><AuthenUsrId/><ConsumerName/><ConsumerProd/><Ver_1/><jXLogTrackingId>{{jXLogTrackingId}}</jXLogTrackingId><Ver_2/><InstRtId>{{XInstitutionRoutingID}}</InstRtId><InstEnv>{{XEnvironment}}</InstEnv><Ver_3/><BusCorrelId>{{guid}}</BusCorrelId><Ver_4/><WorkflowCorrelId/><Ver_5/><ValidConsmName>{{XValidConsumerName}}</ValidConsmName><ValidConsmProd>{{XValidConsumerProduct}}</ValidConsmProd><Ver_6/></jXchangeHdr><Ver_1/><Ver_2/><Ver_3/></MsgRqHdr><InAcctId><AcctId>{{InAcctId.AcctId}}</AcctId><AcctType>{{InAcctId.AcctType}}</AcctType><Ver_1/></InAcctId><LnRateSchedInfo><RateRevDt>{{LnRateSchedInfo.RateRevDt}}</RateRevDt><RateRevDayOfMonth>{{LnRateSchedInfo.RateRevDayOfMonth}}</RateRevDayOfMonth><PrimeRateIdx>{{LnRateSchedInfo.PrimeRateIdx}}</PrimeRateIdx><RateVar>{{LnRateSchedInfo.RateVar}}</RateVar><RateVarCode>{{LnRateSchedInfo.RateVarCode}}</RateVarCode><ReAmrtzPmt>{{LnRateSchedInfo.ReAmrtzPmt}}</ReAmrtzPmt><RateRevTerm>{{LnRateSchedInfo.RateRevTerm}}</RateRevTerm><RateRevTermUnits>{{LnRateSchedInfo.RateRevTermUnits}}</RateRevTermUnits><Ver_1/></LnRateSchedInfo><Ver_1/></LnRateSchedAdd></SOAP-ENV:Body></SOAP-ENV:Envelope>',
        "xml_error_path": "s:Envelope/s:Body/s:Fault/detail/HdrFault/FaultRecInfoArray/FaultMsgRec/ErrDesc",
        "xml_success_path": "s:Envelope/s:Body/LnRateSchedAddResponse/RsStat",
        "xsd_name": "TPG_LoanMaster",
    },
}
org_config = (
    OrganizationConfiguration.objects.all()
    .order_by("-version_major", "-version_minor", "-version_patch")
    .first()
)
for key, value in interfaces.items():
    configuration, _ = Configuration.objects.update_or_create(
        name=key, interface_type=key, defaults={"details": value}
    )
    org_config.details["GLOBAL"][key] = {
        "name": configuration.name,
        "version": configuration.version,
    }
    org_config.save(update_fields=["details"])


organization_config = Configuration.objects.filter(interface_type="organization_config")
for config in organization_config:
    details = config.details
    details['corebanking_name'] = "jackhenry"
    config.details = details
    config.save()
